<!DOCTYPE html>
<html>
<head>
  <title>JobTinder API Tests</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .test-form {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 8px;
    }
    .test-form label {
      font-weight: bold;
    }
    .test-form input, .test-form textarea {
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .test-form button {
      padding: 0.75rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .test-form button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>JobTinder API Tests</h1>

  <h2>Authentication</h2>
  <div class="test-form">
    <button id="protect">Call Protected API</button>
    <button id="logout">Logout</button>
    <button id="seeker">Seeker Page</button>
    <button id="employer">Employer Page</button>
  </div>
  
  <hr/>

  <h2>API Endpoint Tests</h2>

  <div class="test-form">
    <h3>Create Job</h3>
    <label for="job-title">Job Title:</label>
    <input type="text" id="job-title" placeholder="e.g., Senior Developer" />
    <label for="job-description">Description:</label>
    <textarea id="job-description" placeholder="e.g., Seeking a passionate developer..." rows="3"></textarea>
    <button id="createJob">Create Job</button>
  </div>

  <div class="test-form">
    <h3>Create Application</h3>
    <label for="app-job-id">Job ID:</label>
    <input type="number" id="app-job-id" placeholder="e.g., 1" />
    <label for="app-cv-text">CV Text:</label>
    <textarea id="app-cv-text" placeholder="e.g., My CV highlights my experience..." rows="3"></textarea>
    <button id="createApplication">Create Application</button>
  </div>

  <div class="test-form">
    <h3>Create Chat Room</h3>
    <button id="createChatRoom">Create Chat Room</button>
  </div>

  <div class="test-form">
    <h3>Send Message</h3>
    <label for="message-room-id">Chat Room ID:</label>
    <input type="number" id="message-room-id" placeholder="e.g., 1" />
    <label for="message-content">Message Content:</label>
    <textarea id="message-content" placeholder="e.g., Hello, I am interested!" rows="3"></textarea>
    <button id="createMessage">Send Message</button>
  </div>

  <div class="test-form">
    <h3>Create Template</h3>
    <label for="template-type">Template Type:</label>
    <input type="text" id="template-type" placeholder="e.g., cv" />
    <label for="template-name">Template Name:</label>
    <input type="text" id="template-name" placeholder="e.g., Professional Resume" />
    <label for="template-structure">Structure (JSON):</label>
    <textarea id="template-structure" placeholder='e.g., {"sections": ["contact"]}' rows="3"></textarea>
    <button id="createTemplate">Create Template</button>
  </div>

  <script type="module">
    import { startTokenRefreshSchedule, logout, fetchProtected } from "/static/js/keycloak.js";
    import { createJob, createApplication, createChatRoom, createMessage, createTemplate } from "/static/js/user.js";

    // Base URI for your application
    const app_uri = "https://jobtinder.local";

    // --- New Event Listeners from the imported user.js file ---
    document.getElementById("createJob").onclick = () => {
      const titel = document.getElementById("job-title").value;
      const description = document.getElementById("job-description").value;
      createJob(titel, description);
    };

    document.getElementById("createApplication").onclick = () => {
      const jobId = document.getElementById("app-job-id").value;
      const cvText = document.getElementById("app-cv-text").value;
      createApplication(jobId, cvText);
    };

    document.getElementById("createChatRoom").onclick = () => {
      createChatRoom();
    };

    document.getElementById("createMessage").onclick = () => {
      const chatRoomId = document.getElementById("message-room-id").value;
      const messageContent = document.getElementById("message-content").value;
      createMessage(chatRoomId, messageContent);
    };

    document.getElementById("createTemplate").onclick = () => {
      const type = document.getElementById("template-type").value;
      const name = document.getElementById("template-name").value;
      const structure = document.getElementById("template-structure").value;
      try {
        const parsedStructure = JSON.parse(structure);
        createTemplate(type, name, parsedStructure);
      } catch (e) {
        console.error("Invalid JSON structure for template.", e);
        alert("Invalid JSON structure for template.");
      }
    };
    
    // Existing functions from your provided code
    startTokenRefreshSchedule();
    document.getElementById("logout").onclick = () => { logout(); };
    document.getElementById("protect").onclick = () => { fetchProtected(); };
    async function seek() {
        const token = localStorage.getItem("access_token");
        const response = fetch(app_uri + "/auth/seeker", { headers: { Authorization: `Bearer ${token}` } });
        return await response;
    }
    async function employ() {
        const token = localStorage.getItem("access_token");
        const response = fetch(app_uri + "/auth/employer", { headers: { Authorization: `Bearer ${token}` } });
        return await response;
    }
    document.getElementById("seeker").onclick = () => { seek().then(res => res.json()).then(data => console.log(data)); };
    document.getElementById("employer").onclick = () => { employ().then(res => res.json()).then(data => console.log(data)); };
  </script>
</body>
</html>
